<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZapMercado - Painel do Lojista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .navbar-brand {
            font-weight: bold;
            color: #25D366 !important;
        }
        
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .nav-pills .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .nav-pills .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .card-stats {
            border-left: 4px solid #25D366;
            transition: transform 0.2s;
        }
        
        .card-stats:hover {
            transform: translateY(-2px);
        }
        
        .pedido-card {
            transition: all 0.3s;
            border-left: 4px solid #dee2e6;
        }
        
        .pedido-card[data-status="Novo"] {
            border-left-color: #ffc107;
            background-color: #fff8e1;
        }
        
        .pedido-card[data-status="Confirmado"] {
            border-left-color: #28a745;
        }
        
        .pedido-card[data-status="Preparando"] {
            border-left-color: #17a2b8;
        }
        
        .pedido-card[data-status="Saiu para Entrega"] {
            border-left-color: #6f42c1;
        }
        
        .pedido-card[data-status="Entregue"] {
            border-left-color: #20c997;
        }
        
        .pedido-card[data-status="Cancelado"] {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        
        .produto-card {
            transition: transform 0.2s;
        }
        
        .produto-card:hover {
            transform: scale(1.02);
        }
        
        .produto-emoji {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .status-badge {
            font-size: 0.8rem;
            padding: 4px 8px;
        }
        
        .btn-whatsapp {
            background-color: #25D366;
            border-color: #25D366;
            color: white;
        }
        
        .btn-whatsapp:hover {
            background-color: #20B358;
            border-color: #20B358;
            color: white;
        }
        
        .table-pedidos {
            font-size: 0.9rem;
        }
        
        .cliente-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .pedido-timeline {
            border-left: 3px solid #25D366;
            padding-left: 20px;
            margin-left: 10px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #25D366;
        }
        
        .auto-refresh {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fab fa-whatsapp"></i> ZapMercado - Lojista
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle"></i> Carregando...
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#configuracoes" data-bs-toggle="pill" data-bs-target="#configuracoes">
                            <i class="fas fa-cog"></i> Configurações</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Sair</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-3">
                <div class="text-center mb-4">
                    <i class="fas fa-store fa-3x mb-2"></i>
                    <h5>Carregando...</h5>
                </div>
                
                <ul class="nav nav-pills flex-column" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active w-100 text-start" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" type="button">
                            <i class="fas fa-chart-line me-2"></i> Dashboard
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="pedidos-tab" data-bs-toggle="pill" data-bs-target="#pedidos" type="button">
                            <i class="fas fa-shopping-bag me-2"></i> Pedidos
                            <span class="badge bg-danger ms-2" id="badgePedidos">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="produtos-tab" data-bs-toggle="pill" data-bs-target="#produtos" type="button">
                            <i class="fas fa-box me-2"></i> Produtos
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="relatorios-tab" data-bs-toggle="pill" data-bs-target="#relatorios" type="button">
                            <i class="fas fa-chart-bar me-2"></i> Relatórios
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="configuracoes-tab" data-bs-toggle="pill" data-bs-target="#configuracoes" type="button">
                            <i class="fas fa-cog me-2"></i> Configurações
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Conteúdo Principal -->
            <div class="col-md-9 col-lg-10 p-4">
                <div class="tab-content" id="pills-tabContent">
                    
                    <!-- Dashboard -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2>📊 Dashboard</h2>
                            <div class="text-muted">
                                <i class="fas fa-calendar"></i> Hoje: <span id="dataAtual"></span>
                            </div>
                        </div>

                        <!-- Cards de Estatísticas -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Pedidos Hoje</p>
                                                <h3 class="card-title text-primary" id="pedidosHoje">0</h3>
                                            </div>
                                            <div class="text-primary">
                                                <i class="fas fa-shopping-bag fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Faturamento Hoje</p>
                                                <h3 class="card-title text-success" id="faturamentoHoje">R$ 0,00</h3>
                                            </div>
                                            <div class="text-success">
                                                <i class="fas fa-dollar-sign fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Pedidos Pendentes</p>
                                                <h3 class="card-title text-warning" id="pedidosPendentes">0</h3>
                                            </div>
                                            <div class="text-warning">
                                                <i class="fas fa-clock fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Avaliação Média</p>
                                                <h3 class="card-title text-info">4.8 ⭐</h3>
                                            </div>
                                            <div class="text-info">
                                                <i class="fas fa-star fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pedidos Recentes -->
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>📋 Pedidos Recentes</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="pedidosRecentes">
                                            <div class="text-center py-3">
                                                <i class="fas fa-shopping-bag fa-2x text-muted mb-2"></i>
                                                <p class="text-muted">Carregando pedidos...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>🔔 Notificações</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="notificacoesDashboard">
                                            <div class="text-center py-3">
                                                <i class="fas fa-bell fa-2x text-muted mb-2"></i>
                                                <p class="text-muted">Nenhuma notificação</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pedidos -->
                    <div class="tab-pane fade" id="pedidos">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3>📋 Gerenciar Pedidos</h3>
                            <div>
                                <button class="btn btn-primary" onclick="atualizarPedidos()">
                                    <i class="fas fa-sync-alt" id="iconRefresh"></i> Atualizar
                                </button>
                                <span class="badge bg-danger ms-2" id="contadorPedidos">0</span>
                                <span class="badge bg-warning ms-1" id="contadorNotificacoes">0</span>
                            </div>
                        </div>

                        <!-- Filtros -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <select class="form-select" id="filtroStatus" onchange="filtrarPedidos()">
                                    <option value="">Todos os Status</option>
                                    <option value="Novo">🆕 Novos</option>
                                    <option value="Confirmado">✅ Confirmados</option>
                                    <option value="Preparando">👨‍🍳 Preparando</option>
                                    <option value="Saiu para Entrega">🚚 Saiu para Entrega</option>
                                    <option value="Entregue">📦 Entregues</option>
                                    <option value="Cancelado">❌ Cancelados</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="filtroData" onchange="filtrarPedidos()">
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" onclick="marcarTodasNotificacoesLidas()">
                                    <i class="fas fa-check-double"></i> Marcar Todas como Lidas
                                </button>
                                <button class="btn btn-info ms-2" onclick="ativarAutoRefresh()">
                                    <i class="fas fa-sync"></i> Auto-Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Lista de Pedidos -->
                        <div id="listaPedidos">
                            <div class="text-center py-5">
                                <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Carregando pedidos...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Produtos -->
                    <div class="tab-pane fade" id="produtos">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3>📦 Gerenciar Produtos</h3>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#adicionarProdutoModal">
                                <i class="fas fa-plus"></i> Adicionar Produto
                            </button>
                        </div>

                        <div class="row" id="listaProdutos">
                            <!-- Produtos serão carregados aqui -->
                        </div>
                    </div>

                    <!-- Relatórios -->
                    <div class="tab-pane fade" id="relatorios">
                        <h3 class="mb-4">📊 Relatórios</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>📈 Vendas por Período</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="chartVendas"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>🥇 Produtos Mais Vendidos</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="produtosMaisVendidos">
                                            <!-- Lista será gerada aqui -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configurações -->
                    <div class="tab-pane fade" id="configuracoes">
                        <h3 class="mb-4">⚙️ Configurações da Loja</h3>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>🏪 Informações da Loja</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="formConfiguracoes">
                                            <div class="mb-3">
                                                <label class="form-label">Nome da Loja</label>
                                                <input type="text" class="form-control" id="configNomeLoja">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">WhatsApp</label>
                                                <input type="text" class="form-control" id="configWhatsapp">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Taxa de Entrega (R$)</label>
                                                <input type="number" class="form-control" id="configTaxa" step="0.50">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Tempo de Entrega</label>
                                                <input type="text" class="form-control" id="configTempo">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Endereço</label>
                                                <textarea class="form-control" id="configEndereco" rows="2"></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Responsável</label>
                                                <input type="text" class="form-control" id="configResponsavel">
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save"></i> Salvar Alterações
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Pedido -->
    <div class="modal fade" id="detalhesPedidoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">📋 Detalhes do Pedido</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detalhesPedidoConteudo">
                    <!-- Conteúdo será preenchido dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-whatsapp" onclick="contatarCliente()">
                        <i class="fab fa-whatsapp"></i> Contatar Cliente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Produto -->
    <div class="modal fade" id="adicionarProdutoModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">➕ Adicionar Produto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formProduto">
                        <div class="mb-3">
                            <label class="form-label">Nome do Produto</label>
                            <input type="text" class="form-control" id="nomeProduto" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Preço (R$)</label>
                            <input type="number" class="form-control" id="precoProduto" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Categoria</label>
                            <select class="form-select" id="categoriaProduto" required>
                                <option value="">Selecione...</option>
                                <option value="grãos">Grãos</option>
                                <option value="laticínios">Laticínios</option>
                                <option value="carnes">Carnes</option>
                                <option value="frutas">Frutas</option>
                                <option value="verduras">Verduras</option>
                                <option value="bebidas">Bebidas</option>
                                <option value="limpeza">Limpeza</option>
                                <option value="higiene">Higiene</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Emoji</label>
                            <input type="text" class="form-control" id="emojiProduto" placeholder="🍎" maxlength="2">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="adicionarProduto()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===== SISTEMA DE AUTENTICAÇÃO DO LOJISTA =====
        let lojistaAtual = null;
        
        // Verificar se o lojista está logado
        function verificarLogin() {
            const dadosLojista = localStorage.getItem('zapMercadoLojista');
            
            if (!dadosLojista) {
                alert('❌ Você precisa fazer login primeiro!');
                window.location.href = 'cadastro-lojista.html';
                return false;
            }
            
            lojistaAtual = JSON.parse(dadosLojista);
            
            // Atualizar interface com dados do lojista
            document.querySelector('.navbar-nav .dropdown-toggle').innerHTML = 
                `<i class="fas fa-user-circle"></i> ${lojistaAtual.nome}`;
            
            // Atualizar título da sidebar
            document.querySelector('.sidebar h5').textContent = lojistaAtual.nome;
            
            // Carregar dados nas configurações
            carregarConfiguracoes();
            
            return true;
        }
        
        // Carregar dados nas configurações
        function carregarConfiguracoes() {
            if (!lojistaAtual) return;
            
            document.getElementById('configNomeLoja').value = lojistaAtual.nome || '';
            document.getElementById('configWhatsapp').value = lojistaAtual.whatsapp || '';
            document.getElementById('configTaxa').value = lojistaAtual.taxa || '';
            document.getElementById('configTempo').value = lojistaAtual.tempo || '';
            document.getElementById('configEndereco').value = lojistaAtual.endereco || '';
            document.getElementById('configResponsavel').value = lojistaAtual.responsavel || '';
        }
        
        // Logout
        function logout() {
            if (confirm('🚪 Deseja realmente sair?')) {
                localStorage.removeItem('zapMercadoLojista');
                window.location.href = 'cadastro-lojista.html';
            }
        }

        // ===== SISTEMA DE PEDIDOS =====
        let pedidosCarregados = [];
        let pedidoSelecionado = null;
        let notificacoes = [];
        let autoRefreshInterval = null;

        // Produtos da loja
        let produtosLoja = [
            {id: 1, nome: "Arroz Branco 5kg", preco: 15.90, categoria: "grãos", imagem: "🍚"},
            {id: 2, nome: "Feijão Preto 1kg", preco: 8.50, categoria: "grãos", imagem: "🫘"},
            {id: 3, nome: "Açúcar Cristal 1kg", preco: 4.20, categoria: "açúcar", imagem: "🧂"},
            {id: 4, nome: "Óleo de Soja 900ml", preco: 6.80, categoria: "óleo", imagem: "🫗"},
            {id: 5, nome: "Macarrão Espaguete 500g", preco: 3.90, categoria: "massas", imagem: "🍝"},
            {id: 6, nome: "Leite Integral 1L", preco: 4.50, categoria: "laticínios", imagem: "🥛"},
            {id: 7, nome: "Pão de Forma", preco: 5.20, categoria: "padaria", imagem: "🍞"},
            {id: 8, nome: "Ovos 12 unidades", preco: 8.90, categoria: "ovos", imagem: "🥚"}
        ];

        // Carregar pedidos do localStorage
        function carregarPedidos() {
            const dados = localStorage.getItem('zapMercadoPedidos');
            if (dados) {
                pedidosCarregados = JSON.parse(dados);
            } else {
                pedidosCarregados = [];
            }
            return pedidosCarregados;
        }

        // Carregar notificações
        function carregarNotificacoes() {
            const dados = localStorage.getItem('zapMercadoNotificacoes');
            if (dados) {
                notificacoes = JSON.parse(dados);
            } else {
                notificacoes = [];
            }
            return notificacoes;
        }

        // Atualizar contador de notificações
        function atualizarContadorNotificacoes() {
            const naoLidas = notificacoes.filter(n => !n.lida).length;
            document.getElementById('contadorNotificacoes').textContent = naoLidas;
        }

        // Marcar todas as notificações como lidas
        function marcarTodasNotificacoesLidas() {
            notificacoes.forEach(n => n.lida = true);
            localStorage.setItem('zapMercadoNotificacoes', JSON.stringify(notificacoes));
            atualizarContadorNotificacoes();
            atualizarDashboard();
        }
