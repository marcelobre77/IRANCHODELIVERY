<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZapMercado - Painel do Lojista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .navbar-brand {
            font-weight: bold;
            color: #25D366 !important;
        }
        
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .nav-pills .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            margin-bottom: 5px;
        }
        
        .nav-pills .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .nav-pills .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .card-stats {
            border-left: 4px solid #25D366;
            transition: transform 0.2s;
        }
        
        .card-stats:hover {
            transform: translateY(-2px);
        }
        
        .produto-card {
            transition: transform 0.2s;
            height: 100%;
        }
        
        .produto-card:hover {
            transform: scale(1.02);
        }
        
        .produto-emoji {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .produto-imagem {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .produto-preco {
            font-size: 1.2rem;
            font-weight: bold;
            color: #25D366;
        }
        
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #25D366;
            background-color: #f8f9fa;
        }
        
        .upload-area.dragover {
            border-color: #25D366;
            background-color: #e8f5e8;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .image-controls {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fab fa-whatsapp"></i> ZapMercado - Lojista
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" id="nomeLojistaNav">
                        <i class="fas fa-user-circle"></i> Carregando...
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#configuracoes" data-bs-toggle="pill" data-bs-target="#configuracoes">
                            <i class="fas fa-cog"></i> Configura√ß√µes</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Sair</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-3">
                <div class="text-center mb-4">
                    <i class="fas fa-store fa-3x mb-2"></i>
                    <h5 id="nomeLojistaSidebar">Carregando...</h5>
                </div>
                
                <ul class="nav nav-pills flex-column" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active w-100 text-start" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" type="button">
                            <i class="fas fa-chart-line me-2"></i> Dashboard
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="pedidos-tab" data-bs-toggle="pill" data-bs-target="#pedidos" type="button">
                            <i class="fas fa-shopping-bag me-2"></i> Pedidos
                            <span class="badge bg-danger ms-2" id="badgePedidos">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="produtos-tab" data-bs-toggle="pill" data-bs-target="#produtos" type="button">
                            <i class="fas fa-box me-2"></i> Produtos
                            <span class="badge bg-info ms-2" id="badgeProdutos">0</span>
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="relatorios-tab" data-bs-toggle="pill" data-bs-target="#relatorios" type="button">
                            <i class="fas fa-chart-bar me-2"></i> Relat√≥rios
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="configuracoes-tab" data-bs-toggle="pill" data-bs-target="#configuracoes" type="button">
                            <i class="fas fa-cog me-2"></i> Configura√ß√µes
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Conte√∫do Principal -->
            <div class="col-md-9 col-lg-10 p-4">
                <div class="tab-content" id="pills-tabContent">
                    
                    <!-- Dashboard -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2>üìä Dashboard</h2>
                            <div class="text-muted">
                                <i class="fas fa-calendar"></i> Hoje: <span id="dataAtual"></span>
                            </div>
                        </div>

                        <!-- Cards de Estat√≠sticas -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Produtos Cadastrados</p>
                                                <h3 class="card-title text-primary" id="totalProdutos">0</h3>
                                            </div>
                                            <div class="text-primary">
                                                <i class="fas fa-box fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Pedidos Hoje</p>
                                                <h3 class="card-title text-success" id="pedidosHoje">0</h3>
                                            </div>
                                            <div class="text-success">
                                                <i class="fas fa-shopping-bag fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Faturamento</p>
                                                <h3 class="card-title text-info">R$ 0,00</h3>
                                            </div>
                                            <div class="text-info">
                                                <i class="fas fa-dollar-sign fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card card-stats h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <p class="card-category text-muted">Avalia√ß√£o</p>
                                                <h3 class="card-title text-warning">4.8 ‚≠ê</h3>
                                            </div>
                                            <div class="text-warning">
                                                <i class="fas fa-star fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pedidos -->
                    <div class="tab-pane fade" id="pedidos">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3>üìã Gerenciar Pedidos</h3>
                            <button class="btn btn-primary">
                                <i class="fas fa-sync-alt"></i> Atualizar
                            </button>
                        </div>
                        <div class="text-center py-5">
                            <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Nenhum pedido encontrado</p>
                        </div>
                    </div>

                    <!-- Produtos -->
                    <div class="tab-pane fade" id="produtos">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3>üì¶ Meus Produtos (<span id="contadorProdutos">0</span>)</h3>
                            <button class="btn btn-success" onclick="abrirModalProduto()">
                                <i class="fas fa-plus"></i> Adicionar Produto
                            </button>
                        </div>

                        <div class="row" id="listaProdutos">
                            <!-- Produtos ser√£o carregados aqui -->
                        </div>
                    </div>

                    <!-- Relat√≥rios -->
                    <div class="tab-pane fade" id="relatorios">
                        <h3 class="mb-4">üìä Relat√≥rios</h3>
                        <div class="text-center py-5">
                            <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Relat√≥rios em desenvolvimento</p>
                        </div>
                    </div>

                    <!-- Configura√ß√µes -->
                    <div class="tab-pane fade" id="configuracoes">
                        <h3 class="mb-4">‚öôÔ∏è Configura√ß√µes da Loja</h3>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>üè™ Informa√ß√µes da Loja</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="formConfiguracoes" onsubmit="salvarConfiguracoes(event)">
                                            <div class="mb-3">
                                                <label class="form-label">Nome da Loja</label>
                                                <input type="text" class="form-control" id="configNomeLoja" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">WhatsApp</label>
                                                <input type="text" class="form-control" id="configWhatsapp" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Taxa de Entrega (R$)</label>
                                                <input type="number" class="form-control" id="configTaxa" step="0.50" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Tempo de Entrega</label>
                                                <input type="text" class="form-control" id="configTempo" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Endere√ßo</label>
                                                <textarea class="form-control" id="configEndereco" rows="2" required></textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Respons√°vel</label>
                                                <input type="text" class="form-control" id="configResponsavel" required>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save"></i> Salvar Altera√ß√µes
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar/Editar Produto -->
    <div class="modal fade" id="produtoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="produtoModalTitle">‚ûï Adicionar Produto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formProduto">
                        <input type="hidden" id="produtoId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nome do Produto *</label>
                                    <input type="text" class="form-control" id="nomeProduto" required 
                                           placeholder="Ex: Arroz Branco 5kg">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Pre√ßo (R$) *</label>
                                    <input type="number" class="form-control" id="precoProduto" 
                                           step="0.01" min="0" required placeholder="Ex: 15.90">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Categoria *</label>
                                    <select class="form-select" id="categoriaProduto" required>
                                        <option value="">Selecione uma categoria...</option>
                                        <option value="gr√£os">üåæ Gr√£os e Cereais</option>
                                        <option value="latic√≠nios">ü•õ Latic√≠nios</option>
                                        <option value="carnes">ü•© Carnes e Aves</option>
                                        <option value="frutas">üçé Frutas</option>
                                        <option value="verduras">ü•¨ Verduras e Legumes</option>
                                        <option value="bebidas">ü•§ Bebidas</option>
                                        <option value="limpeza">üßΩ Produtos de Limpeza</option>
                                        <option value="higiene">üßº Higiene Pessoal</option>
                                        <option value="outros">üì¶ Outros</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Emoji (Opcional)</label>
                                    <input type="text" class="form-control" id="emojiProduto" 
                                           placeholder="üçé" maxlength="2">
                                    <small class="text-muted">Escolha um emoji que represente seu produto</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Descri√ß√£o (Opcional)</label>
                                    <textarea class="form-control" id="descricaoProduto" rows="3" 
                                              placeholder="Descri√ß√£o do produto..."></textarea>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Imagem do Produto</label>
                                    <div class="upload-area" onclick="document.getElementById('imagemProduto').click()">
                                        <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                                        <p class="text-muted mb-0">Clique aqui ou arraste uma imagem</p>
                                        <small class="text-muted">JPG, PNG - M√°ximo 2MB</small>
                                    </div>
                                    <input type="file" id="imagemProduto" accept="image/jpeg,image/png,image/jpg" 
                                           style="display: none;" onchange="processarImagem(this)">
                                    
                                    <div id="previewContainer" style="display: none;">
                                        <img id="previewImagem" class="preview-image" alt="Preview">
                                        <div class="image-controls">
                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removerImagem()">
                                                <i class="fas fa-trash"></i> Remover Imagem
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="document.getElementById('imagemProduto').click()">
                                                <i class="fas fa-edit"></i> Trocar Imagem
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="salvarProduto()">
                        <i class="fas fa-save"></i> Salvar Produto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ===== VARI√ÅVEIS GLOBAIS =====
        let lojistaAtual = null;
        let produtosLoja = [];
        let produtoModal = null;
        let produtoEditando = null;
        let imagemAtual = null;
        
        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando sistema...');
            
            if (verificarLogin()) {
                inicializarSistema();
            }
        });
        
        function inicializarSistema() {
            produtoModal = new bootstrap.Modal(document.getElementById('produtoModal'));
            carregarConfiguracoes();
            carregarProdutos();
            atualizarDataAtual();
            configurarDragAndDrop();
            console.log('‚úÖ Sistema inicializado com sucesso!');
        }
        
        // ===== AUTENTICA√á√ÉO =====
        function verificarLogin() {
            const dadosLojista = localStorage.getItem('zapMercadoLojista');
            
            if (!dadosLojista) {
                alert('‚ùå Voc√™ precisa fazer login primeiro!');
                window.location.href = 'cadastro-lojista.html';
                return false;
            }
            
            lojistaAtual = JSON.parse(dadosLojista);
            console.log('‚úÖ Lojista logado:', lojistaAtual);
            
            document.getElementById('nomeLojistaNav').innerHTML = 
                `<i class="fas fa-user-circle"></i> ${lojistaAtual.nome}`;
            document.getElementById('nomeLojistaSidebar').textContent = lojistaAtual.nome;
            
            return true;
        }
        
        function logout() {
            if (confirm('üö™ Deseja realmente sair?')) {
                localStorage.removeItem('zapMercadoLojista');
                window.location.href = 'cadastro-lojista.html';
            }
        }

        // ===== CONFIGURA√á√ïES =====
        function carregarConfiguracoes() {
            if (!lojistaAtual) return;
            
            document.getElementById('configNomeLoja').value = lojistaAtual.nome || '';
            document.getElementById('configWhatsapp').value = lojistaAtual.whatsapp || '';
            document.getElementById('configTaxa').value = lojistaAtual.taxa || '5.00';
            document.getElementById('configTempo').value = lojistaAtual.tempo || '30-45 min';
            document.getElementById('configEndereco').value = lojistaAtual.endereco || '';
            document.getElementById('configResponsavel').value = lojistaAtual.responsavel || '';
        }
        
        function salvarConfiguracoes(event) {
            event.preventDefault();
            
            if (!lojistaAtual) return;
            
            lojistaAtual.nome = document.getElementById('configNomeLoja').value;
            lojistaAtual.whatsapp = document.getElementById('configWhatsapp').value;
            lojistaAtual.taxa = parseFloat(document.getElementById('configTaxa').value);
            lojistaAtual.tempo = document.getElementById('configTempo').value;
            lojistaAtual.endereco = document.getElementById('configEndereco').value;
            lojistaAtual.responsavel = document.getElementById('configResponsavel').value;
            
            localStorage.setItem('zapMercadoLojista', JSON.stringify(lojistaAtual));
            
            document.getElementById('nomeLojistaNav').innerHTML = 
                `<i class="fas fa-user-circle"></i> ${lojistaAtual.nome}`;
            document.getElementById('nomeLojistaSidebar').textContent = lojistaAtual.nome;
            
            alert('‚úÖ Configura√ß√µes salvas com sucesso!');
        }

        // ===== SISTEMA DE PRODUTOS =====
        function carregarProdutos() {
            if (!lojistaAtual) return;
            
            console.log('üîÑ Carregando produtos...');
            
            const chave = `zapMercadoProdutos_${lojistaAtual.id}`;
            const dados = localStorage.getItem(chave);
            
            if (dados) {
                produtosLoja = JSON.parse(dados);
                console.log('üì¶ Produtos carregados:', produtosLoja);
            } else {
                produtosLoja = [];
                console.log('üì¶ Nenhum produto encontrado');
            }
            
            exibirProdutos();
            atualizarContadores();
        }
        
        function salvarProdutos() {
            if (!lojistaAtual) return;
            
            const chave = `zapMercadoProdutos_${lojistaAtual.id}`;
            localStorage.setItem(chave, JSON.stringify(produtosLoja));
            console.log('üíæ Produtos salvos no localStorage');
        }
        
        function exibirProdutos() {
            const lista = document.getElementById('listaProdutos');
            
            if (produtosLoja.length === 0) {
                lista.innerHTML = `
                    <div class="col-12">
                        <div class="text-center py-5">
                            <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Nenhum produto cadastrado</h5>
                            <p class="text-muted">Clique em "Adicionar Produto" para come√ßar</p>
                            <button class="btn btn-success" onclick="abrirModalProduto()">
                                <i class="fas fa-plus"></i> Adicionar Primeiro Produto
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            produtosLoja.forEach(produto => {
                const imagemSrc = produto.imagemBase64 || 
                    (produto.imagem && produto.imagem !== 'üì¶' ? 
                        `data:text/plain;charset=utf-8,${produto.imagem}` : null);
                
                html += `
                    <div class="col-md-4 col-lg-3 mb-4">
                        <div class="card produto-card h-100">
                            <div class="card-body text-center">
                                ${produto.imagemBase64 ? 
                                    `<img src="${produto.imagemBase64}" class="produto-imagem" alt="${produto.nome}">` :
                                    `<div class="produto-emoji">${produto.imagem || 'üì¶'}</div>`
                                }
                                <h6 class="card-title">${produto.nome}</h6>
                                <p class="produto-preco">R$ ${produto.preco.toFixed(2)}</p>
                                <span class="badge bg-secondary mb-2">${produto.categoria}</span>
                                ${produto.descricao ? `<p class="text-muted small">${produto.descricao}</p>` : ''}
                            </div>
                            <div class="card-footer text-center">
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editarProduto(${produto.id})">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="excluirProduto(${produto.id})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lista.innerHTML = html;
        }
        
        function atualizarContadores() {
            const total = produtosLoja.length;
            document.getElementById('contadorProdutos').textContent = total;
            document.getElementById('badgeProdutos').textContent = total;
            document.getElementById('totalProdutos').textContent = total;
        }
        
        function abrirModalProduto() {
            produtoEditando = null;
            imagemAtual = null;
            document.getElementById('produtoModalTitle').textContent = '‚ûï Adicionar Produto';
            limparFormularioProduto();
            produtoModal.show();
        }
        
        function editarProduto(id) {
            produtoEditando = produtosLoja.find(p => p.id === id);
            if (!produtoEditando) return;
            
            document.getElementById('produtoModalTitle').textContent = '‚úèÔ∏è Editar Produto';
            
            document.getElementById('produtoId').value = produtoEditando.id;
            document.getElementById('nomeProduto').value = produtoEditando.nome;
            document.getElementById('precoProduto').value = produtoEditando.preco;
            document.getElementById('categoriaProduto').value = produtoEditando.categoria;
            document.getElementById('emojiProduto').value = produtoEditando.imagem || '';
            document.getElementById('descricaoProduto').value = produtoEditando.descricao || '';
            
            if (produtoEditando.imagemBase64) {
                imagemAtual = produtoEditando.imagemBase64;
                mostrarPreview(produtoEditando.imagemBase64);
            }
            
            produtoModal.show();
        }
        
        function salvarProduto() {
            const nome = document.getElementById('nomeProduto').value.trim();
            const preco = parseFloat(document.getElementById('precoProduto').value);
            const categoria = document.getElementById('categoriaProduto').value;
            const emoji = document.getElementById('emojiProduto').value.trim();
                        const descricao = document.getElementById('descricaoProduto').value.trim();
            
            // Valida√ß√µes
            if (!nome) {
                alert('‚ùå Nome do produto √© obrigat√≥rio!');
                return;
            }
            
            if (!preco || preco <= 0) {
                alert('‚ùå Pre√ßo deve ser maior que zero!');
                return;
            }
            
            if (!categoria) {
                alert('‚ùå Categoria √© obrigat√≥ria!');
                return;
            }
            
            if (produtoEditando) {
                // Editando produto existente
                const index = produtosLoja.findIndex(p => p.id === produtoEditando.id);
                if (index !== -1) {
                    produtosLoja[index] = {
                        ...produtoEditando,
                        nome: nome,
                        preco: preco,
                        categoria: categoria,
                        imagem: emoji || 'üì¶',
                        imagemBase64: imagemAtual,
                        descricao: descricao
                    };
                    console.log('‚úÖ Produto editado:', produtosLoja[index]);
                }
            } else {
                // Novo produto
                const novoId = produtosLoja.length > 0 ? Math.max(...produtosLoja.map(p => p.id)) + 1 : 1;
                const novoProduto = {
                    id: novoId,
                    nome: nome,
                    preco: preco,
                    categoria: categoria,
                    imagem: emoji || 'üì¶',
                    imagemBase64: imagemAtual,
                    descricao: descricao
                };
                
                produtosLoja.push(novoProduto);
                console.log('‚úÖ Novo produto adicionado:', novoProduto);
            }
            
            // Salvar e atualizar
            salvarProdutos();
            exibirProdutos();
            atualizarContadores();
            
            // Fechar modal
            produtoModal.hide();
            limparFormularioProduto();
            
            alert(produtoEditando ? '‚úÖ Produto editado com sucesso!' : '‚úÖ Produto adicionado com sucesso!');
        }
        
        function excluirProduto(id) {
            const produto = produtosLoja.find(p => p.id === id);
            if (!produto) return;
            
            if (confirm(`üóëÔ∏è Deseja excluir o produto "${produto.nome}"?`)) {
                produtosLoja = produtosLoja.filter(p => p.id !== id);
                salvarProdutos();
                exibirProdutos();
                atualizarContadores();
                alert('‚úÖ Produto exclu√≠do com sucesso!');
            }
        }
        
        function limparFormularioProduto() {
            document.getElementById('formProduto').reset();
            document.getElementById('produtoId').value = '';
            imagemAtual = null;
            document.getElementById('previewContainer').style.display = 'none';
        }

        // ===== SISTEMA DE UPLOAD DE IMAGENS =====
        function configurarDragAndDrop() {
            const uploadArea = document.querySelector('.upload-area');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    processarImagem({ files: files });
                }
            }
        }
        
        function processarImagem(input) {
            const file = input.files[0];
            
            if (!file) return;
            
            // Validar tipo de arquivo
            if (!file.type.match(/^image\/(jpeg|jpg|png)$/)) {
                alert('‚ùå Por favor, selecione apenas arquivos JPG ou PNG!');
                return;
            }
            
            // Validar tamanho (2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('‚ùå A imagem deve ter no m√°ximo 2MB!');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Redimensionar se necess√°rio
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Definir tamanho m√°ximo
                    const maxWidth = 800;
                    const maxHeight = 600;
                    
                    let { width, height } = img;
                    
                    // Calcular novo tamanho mantendo propor√ß√£o
                    if (width > height) {
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Desenhar imagem redimensionada
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Converter para base64
                    imagemAtual = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Mostrar preview
                    mostrarPreview(imagemAtual);
                };
                
                img.src = e.target.result;
            };
            
            reader.readAsDataURL(file);
        }
        
        function mostrarPreview(imagemBase64) {
            document.getElementById('previewImagem').src = imagemBase64;
            document.getElementById('previewContainer').style.display = 'block';
        }
        
        function removerImagem() {
            imagemAtual = null;
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('imagemProduto').value = '';
        }
        
        // ===== UTILIT√ÅRIOS =====
        function atualizarDataAtual() {
            const hoje = new Date();
            const dataFormatada = hoje.toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('dataAtual').textContent = dataFormatada;
        }
    </script>
</body>
</html>
